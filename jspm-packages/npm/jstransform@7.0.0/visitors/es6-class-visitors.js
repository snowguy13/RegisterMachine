/* */
"format cjs";"use strict";function resetSymbols(){_anonClassUUIDCounter=0,_mungedSymbolMaps={}}function _generateAnonymousClassName(e){var t=e.mungeNamespace||"";return"____Class"+t+base62.encode(_anonClassUUIDCounter++)}function _getMungedName(e,t){var o=t.mungeNamespace,r=t.g.opts.minify;if(r){_mungedSymbolMaps[o]||(_mungedSymbolMaps[o]={symbolMap:{},identUUIDCounter:0});var n=_mungedSymbolMaps[o].symbolMap;n[e]||(n[e]=base62.encode(_mungedSymbolMaps[o].identUUIDCounter++)),e=n[e]}return"$"+o+e}function _getSuperClassInfo(e,t){var o={name:null,expression:null};return e.superClass&&(e.superClass.type===Syntax.Identifier?o.name=e.superClass.name:(o.name=_generateAnonymousClassName(t),o.expression=t.g.source.substring(e.superClass.range[0],e.superClass.range[1]))),o}function _isConstructorMethod(e){return e.type===Syntax.MethodDefinition&&e.key.type===Syntax.Identifier&&"constructor"===e.key.name}function _shouldMungeIdentifier(e,t){return!!t.methodFuncNode&&!utils.getDocblock(t).hasOwnProperty("preventMunge")&&/^_(?!_)/.test(e.name)}function visitClassMethod(e,t,o,r){if(!r.g.opts.es5&&("get"===t.kind||"set"===t.kind))throw new Error("This transform does not support "+t.kind+"ter methods for ES6 classes. (line: "+t.loc.start.line+", col: "+t.loc.start.column+")");return r=utils.updateState(r,{methodNode:t}),utils.catchup(t.range[0],r),o.unshift(t),e(t.value,o,r),o.shift(),!1}function visitClassFunctionExpression(e,t,o,r){var n=o[0],s="get"===n.kind,a="set"===n.kind;if(r=utils.updateState(r,{methodFuncNode:t}),"constructor"===n.key.name)utils.append("function "+r.className,r);else{var i,c=n.static?"":".prototype",u=r.className+c;n.key.type===Syntax.Identifier?(i=n.key.name,_shouldMungeIdentifier(n.key,r)&&(i=_getMungedName(i,r)),i=s||a?JSON.stringify(i):reservedWordsHelper.isReservedWord(i)?"["+JSON.stringify(i)+"]":"."+i):n.key.type===Syntax.Literal&&(i=JSON.stringify(n.key.value),s||a||(i="["+i+"]")),a||s?utils.append("Object.defineProperty("+u+","+i+",{enumerable:true,configurable:true,"+n.kind+":function",r):utils.append(u+i+"=function"+(t.generator?"*":""),r)}utils.move(n.key.range[1],r),utils.append("(",r);var p=t.params;if(p.length>0){utils.move(p[0].range[0],r);for(var l=0;l<p.length;l++)utils.catchup(t.params[l].range[0],r),o.unshift(t),e(p[l],o,r),o.shift()}return utils.append(")",r),utils.catchupWhiteSpace(t.body.range[0],r),utils.append("{",r),r.scopeIsStrict||(utils.append('"use strict";',r),r=utils.updateState(r,{scopeIsStrict:!0})),utils.move(t.body.range[0]+"{".length,r),o.unshift(t),e(t.body,o,r),o.shift(),utils.catchup(t.body.range[1],r),"constructor"!==n.key.name&&((s||a)&&utils.append("})",r),utils.append(";",r)),!1}function visitClassMethodParam(e,t,o,r){var n=t.name;_shouldMungeIdentifier(t,r)&&(n=_getMungedName(t.name,r)),utils.append(n,r),utils.move(t.range[1],r)}function _renderClassBody(e,t,o,r){var n=r.className,s=r.superClass;if(s.name){null!==s.expression&&utils.append("var "+s.name+"="+s.expression+";",r);var a=s.name+"____Key",i="";utils.identWithinLexicalScope(a,r)||(i="var ",declareIdentInLocalScope(a,initScopeMetadata(t),r)),utils.append("for("+i+a+" in "+s.name+"){if("+s.name+".hasOwnProperty("+a+")){"+n+"["+a+"]="+s.name+"["+a+"];}}",r);var c=SUPER_PROTO_IDENT_PREFIX+s.name;utils.identWithinLexicalScope(c,r)||(utils.append("var "+c+"="+s.name+"===null?null:"+s.name+".prototype;",r),declareIdentInLocalScope(c,initScopeMetadata(t),r)),utils.append(n+".prototype=Object.create("+c+");",r),utils.append(n+".prototype.constructor="+n+";",r),utils.append(n+".__superConstructor__="+s.name+";",r)}t.body.body.filter(_isConstructorMethod).pop()||(utils.append("function "+n+"(){",r),r.scopeIsStrict||utils.append('"use strict";',r),s.name&&utils.append("if("+s.name+"!==null){"+s.name+".apply(this,arguments);}",r),utils.append("}",r)),utils.move(t.body.range[0]+"{".length,r),e(t.body,o,r),utils.catchupWhiteSpace(t.range[1],r)}function visitClassDeclaration(e,t,o,r){var n=t.id.name,s=_getSuperClassInfo(t,r);return r=utils.updateState(r,{mungeNamespace:n,className:n,superClass:s}),_renderClassBody(e,t,o,r),!1}function visitClassExpression(e,t,o,r){var n=t.id&&t.id.name||_generateAnonymousClassName(r),s=_getSuperClassInfo(t,r);return utils.append("(function(){",r),r=utils.updateState(r,{mungeNamespace:n,className:n,superClass:s}),_renderClassBody(e,t,o,r),utils.append("return "+n+";})()",r),!1}function visitPrivateIdentifier(e,t,o,r){utils.append(_getMungedName(t.name,r),r),utils.move(t.range[1],r)}function visitSuperCallExpression(e,t,o,r){var n=r.superClass.name;if(t.callee.type===Syntax.Identifier){if(_isConstructorMethod(r.methodNode))utils.append(n+".call(",r);else{var s=SUPER_PROTO_IDENT_PREFIX+n;r.methodNode.key.type===Syntax.Identifier?s+="."+r.methodNode.key.name:r.methodNode.key.type===Syntax.Literal&&(s+="["+JSON.stringify(r.methodNode.key.value)+"]"),utils.append(s+".call(",r)}utils.move(t.callee.range[1],r)}else t.callee.type===Syntax.MemberExpression&&(utils.append(SUPER_PROTO_IDENT_PREFIX+n,r),utils.move(t.callee.object.range[1],r),t.callee.computed?utils.catchup(t.callee.property.range[1]+"]".length,r):utils.append("."+t.callee.property.name,r),utils.append(".call(",r),utils.move(t.callee.range[1],r));return utils.append("this",r),t.arguments.length>0&&(utils.append(",",r),utils.catchupWhiteSpace(t.arguments[0].range[0],r),e(t.arguments,o,r)),utils.catchupWhiteSpace(t.range[1],r),utils.append(")",r),!1}function visitSuperMemberExpression(e,t,o,r){var n=r.superClass.name;utils.append(SUPER_PROTO_IDENT_PREFIX+n,r),utils.move(t.object.range[1],r)}var base62=require("base62"),Syntax=require("esprima-fb").Syntax,utils=require("../src/utils"),reservedWordsHelper=require("./reserved-words-helper"),declareIdentInLocalScope=utils.declareIdentInLocalScope,initScopeMetadata=utils.initScopeMetadata,SUPER_PROTO_IDENT_PREFIX="____SuperProtoOf",_anonClassUUIDCounter=0,_mungedSymbolMaps={};visitClassMethod.test=function(e){return e.type===Syntax.MethodDefinition},visitClassFunctionExpression.test=function(e,t){return e.type===Syntax.FunctionExpression&&t[0].type===Syntax.MethodDefinition},visitClassMethodParam.test=function(e,t){if(t[0]&&t[1]){var o=t[0],r=t[1];return o.type===Syntax.FunctionExpression&&r.type===Syntax.MethodDefinition&&e.type===Syntax.Identifier}},visitClassDeclaration.test=function(e){return e.type===Syntax.ClassDeclaration},visitClassExpression.test=function(e){return e.type===Syntax.ClassExpression},visitPrivateIdentifier.test=function(e,t,o){if(e.type===Syntax.Identifier&&_shouldMungeIdentifier(e,o)){if(t[0].type===Syntax.MemberExpression&&t[0].object!==e&&t[0].computed===!1)return!0;if(utils.identWithinLexicalScope(e.name,o,o.methodFuncNode))return!0;if(t[0].type===Syntax.Property&&t[1].type===Syntax.ObjectExpression)return!0;if(t[0].type===Syntax.FunctionExpression||t[0].type===Syntax.FunctionDeclaration||t[0].type===Syntax.ArrowFunctionExpression)for(var r=0;r<t[0].params.length;r++)if(t[0].params[r]===e)return!0}return!1},visitSuperCallExpression.test=function(e,t,o){if(o.superClass&&e.type===Syntax.CallExpression){var r=e.callee;if(r.type===Syntax.Identifier&&"super"===r.name||r.type==Syntax.MemberExpression&&"super"===r.object.name)return!0}return!1},visitSuperMemberExpression.test=function(e,t,o){return o.superClass&&e.type===Syntax.MemberExpression&&e.object.type===Syntax.Identifier&&"super"===e.object.name},exports.resetSymbols=resetSymbols,exports.visitorList=[visitClassDeclaration,visitClassExpression,visitClassFunctionExpression,visitClassMethod,visitClassMethodParam,visitPrivateIdentifier,visitSuperCallExpression,visitSuperMemberExpression];
//# sourceMappingURL=es6-class-visitors.js.map