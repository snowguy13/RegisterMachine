/* */
"format cjs";require("mock-modules").autoMockOff(),describe("jstransform",function(){function e(e,t,n){function o(e,t,r,o){return a++,n(e,t,r,o)}var a=0;o.test=n.test,r([o],e),expect(a).toBe(t)}function t(t,n,r,o){function a(e,t,r,o){var a=Object.keys(o.localScope.identifiers);expect(a.sort()).toEqual(n.sort())}a.test=o,e(t,r,a)}function n(t,n,r,o){function a(e,t,r,o){n=n&&n.sort();var a=o.localScope.parentScope,i=a&&Object.keys(a.identifiers).sort();expect(i).toEqual(n)}a.test=o,e(t,r,a)}var r,o=require("esprima-fb").Syntax;beforeEach(function(){require("mock-modules").dumpCache(),r=require("../jstransform").transform}),describe("closure scope boundaries",function(){it("creates a scope boundary around Program scope",function(){var e="var foo;var bar, baz;function blah() {}",n=["foo","bar","baz","blah"];t(e,n,3,function(e,t){return t[0]&&t[0].type===o.Program})}),it("creates a scope boundary around FunctionDeclarations",function(){var e="var foo;function blah() {  var bar;  function nested() {    var baz;  }}",n=["foo","blah"],r=["arguments","bar","nested"],a=["arguments","baz"];t(e,n,2,function(e,t){return t[0]&&t[0].type===o.Program}),t(e,r,2,function(e,t){return t[0]&&t[0].type===o.BlockStatement&&t[1]&&t[1].type===o.FunctionDeclaration&&"blah"===t[1].id.name}),t(e,a,1,function(e,t){return t[0]&&t[0].type===o.BlockStatement&&t[1]&&t[1].type===o.FunctionDeclaration&&"nested"===t[1].id.name})}),it("creates a scope boundary around MethodDefinitions",function(){var e="var foo;class ClassA {  blah() {    var bar;  }  another() {    var baz;  }}",n=["foo","ClassA"],r=["arguments","bar"],a=["arguments","baz"];t(e,n,2,function(e,t){return t[0]&&t[0].type===o.Program}),t(e,r,1,function(e,t){return t[0]&&t[0].type===o.BlockStatement&&t[1]&&t[1].type===o.FunctionExpression&&t[2]&&t[2].type===o.MethodDefinition&&"blah"===t[2].key.name}),t(e,a,1,function(e,t){return t[0]&&t[0].type===o.BlockStatement&&t[1]&&t[1].type===o.FunctionExpression&&t[2]&&t[2].type===o.MethodDefinition&&"another"===t[2].key.name})}),it("uses VariableDeclarations to determine scope boundary",function(){var e="var foo = 1;function bar() {  foo++;  function baz() {    var foo = 2;  }}",n=["foo","bar"],r=["arguments","baz"],a=["arguments","foo"];t(e,n,2,function(e,t){return t[0]&&t[0].type===o.Program}),t(e,r,2,function(e,t){return t[0]&&t[0].type===o.BlockStatement&&t[1]&&t[1].type===o.FunctionDeclaration&&"bar"===t[1].id.name}),t(e,a,1,function(e,t){return t[0]&&t[0].type===o.BlockStatement&&t[1]&&t[1].type===o.FunctionDeclaration&&"baz"===t[1].id.name})}),it("includes function args in functions scope boundary",function(){var e="var foo;function blah(bar) {  var baz;}",n=["foo","blah"],r=["arguments","bar","baz"];t(e,n,2,function(e,t){return t[0]&&t[0].type===o.Program}),t(e,r,1,function(e,t){return t[0]&&t[0].type===o.BlockStatement&&t[1]&&t[1].type===o.FunctionDeclaration&&"blah"===t[1].id.name})}),it("puts FunctionExpression names within function scope",function(){var e="var foo;var bar = function baz() {  var blah;};",n=["foo","bar"],r=["arguments","baz","blah"];t(e,n,2,function(e,t){return t[0]&&t[0].type===o.Program}),t(e,r,1,function(e,t){return t[0]&&t[0].type===o.BlockStatement&&t[1]&&t[1].type===o.FunctionExpression&&"baz"===t[1].id.name})})}),describe("block scope boundaries",function(){it("creates a scope boundary around CatchClauses with params",function(){var e="var blah = 0;try {} catch (e) {  blah++;}",n=["blah"],r=["e"];t(e,n,2,function(e,t){return t[0]&&t[0].type===o.Program}),t(e,r,1,function(e,t){return t[0]&&t[0].type===o.BlockStatement&&t[1]&&t[1].type===o.CatchClause})}),it("includes vars defined in CatchClauses in the parent scope",function(){var e="try {} catch (e) {  var blah;}",n=["blah"],r=["e"];t(e,n,1,function(e,t){return t[0]&&t[0].type===o.Program}),t(e,r,1,function(e,t){return t[0]&&t[0].type===o.BlockStatement&&t[1]&&t[1].type===o.CatchClause})})}),describe("scope chain linking",function(){it("links parent scope boundaries",function(){var e="var foo;function blah() {  var bar;  function nested() {    var baz;  }}",t=["foo","blah"],r=["arguments","bar","nested"];n(e,t,2,function(e,t){return t[0]&&t[0].type===o.BlockStatement&&t[1]&&t[1].type===o.FunctionDeclaration&&"blah"===t[1].id.name}),n(e,r,1,function(e,t){return t[0]&&t[0].type===o.BlockStatement&&t[1]&&t[1].type===o.FunctionDeclaration&&"nested"===t[1].id.name})}),it("nests MethodDefinition boundaries under parent scope",function(){var e="var foo;class ClassA {  blah() {    var bar;  }}",t=["foo","ClassA"];n(e,t,1,function(e,t){return t[0]&&t[0].type===o.BlockStatement&&t[1]&&t[1].type===o.FunctionExpression&&t[2]&&t[2].type===o.MethodDefinition&&"blah"===t[2].key.name})})}),describe('"use strict" tracking',function(){function e(e,t){function n(t,n,r,o){a++,expect(o.scopeIsStrict).toBe(e)}var a=0;n.test=function(e){return e.type===o.Literal&&"testStr"===e.value},r([n],t),expect(a).toBe(1)}it("detects program-level strictness",function(){e(!1,'"testStr";'),e(!0,'"use strict"; "testStr";')}),it("detects non-inherited strictness",function(){e(!0,["function foo() {",'  "use strict";','  "testStr";',"}"].join("\n"))}),it("detects program-inherited strictness",function(){e(!0,['"use strict";',"function foo() {",'  "testStr";',"}"].join("\n"))}),it("detects function-inherited strictness",function(){e(!0,["function foo() {",'  "use strict";',"  function bar() {",'    "testStr";',"  }","}"].join("\n"))}),it("does not detect sibling strictness",function(){e(!1,["function foo() {",'  "use strict";',"}","function bar() {",'  "testStr";',"}"].join("\n"))})}),describe("visitors",function(){it("should visit nodes in order",function(){function e(e,t){a.push([t.id.name,t.range[0]])}function t(e,t){a.push([t.value,t.range[0]])}var n=["// Foo comment","function foo() {}","","// Bar comment","function bar() {}"].join("\n"),a=[];e.test=function(e){return e.type===o.FunctionDeclaration},t.test=function(e){return"Line"===e.type},r([t,e],n),expect(a).toEqual([[" Foo comment",0],["foo",15],[" Bar comment",34],["bar",49]])})})});
//# sourceMappingURL=jstransform-test.js.map