/* */
"format cjs";"use strict";function _nodeIsClosureScopeBoundary(e,t){if(e.type===Syntax.Program)return!0;var r=t.type===Syntax.FunctionDeclaration||t.type===Syntax.FunctionExpression||t.type===Syntax.ArrowFunctionExpression;return e.type===Syntax.BlockStatement&&r}function _nodeIsBlockScopeBoundary(e,t){return e.type===Syntax.Program?!1:e.type===Syntax.BlockStatement&&t.type===Syntax.CatchClause}function traverse(e,t,r){function n(e,t,r){e.range&&utils.catchup(e.range[0],r),traverse(e,t,r),e.range&&utils.catchup(e.range[1],r)}var a=t[0];if(!Array.isArray(e)&&r.localScope.parentNode!==a){if(_nodeIsClosureScopeBoundary(e,a)){var o=r.scopeIsStrict||e.body.length>0&&e.body[0].type===Syntax.ExpressionStatement&&e.body[0].expression.type===Syntax.Literal&&"use strict"===e.body[0].expression.value;if(e.type===Syntax.Program)r=utils.updateState(r,{scopeIsStrict:o});else{if(r=utils.updateState(r,{localScope:{parentNode:a,parentScope:r.localScope,identifiers:{},tempVarIndex:0},scopeIsStrict:o}),declareIdentInScope("arguments",initScopeMetadata(e),r),a.params.length>0)for(var i,u=0;u<a.params.length;u++)i=a.params[u],i.type===Syntax.Identifier&&declareIdentInScope(i.name,initScopeMetadata(a),r);if(a.type===Syntax.FunctionExpression&&a.id){var s=initScopeMetadata(a,t.parentNodeslice,a);declareIdentInScope(a.id.name,s,r)}}collectClosureIdentsAndTraverse(e,t,r)}_nodeIsBlockScopeBoundary(e,a)&&(r=utils.updateState(r,{localScope:{parentNode:a,parentScope:r.localScope,identifiers:{}}}),a.type===Syntax.CatchClause&&declareIdentInScope(a.param.name,initScopeMetadata(a),r),collectBlockIdentsAndTraverse(e,t,r))}utils.analyzeAndTraverse(walker,n,e,t,r)}function collectClosureIdentsAndTraverse(e,t,r){utils.analyzeAndTraverse(visitLocalClosureIdentifiers,collectClosureIdentsAndTraverse,e,t,r)}function collectBlockIdentsAndTraverse(e,t,r){utils.analyzeAndTraverse(visitLocalBlockIdentifiers,collectBlockIdentsAndTraverse,e,t,r)}function visitLocalClosureIdentifiers(e,t,r){var n;switch(e.type){case Syntax.FunctionExpression:return!1;case Syntax.ClassDeclaration:case Syntax.ClassExpression:case Syntax.FunctionDeclaration:return e.id&&(n=initScopeMetadata(getBoundaryNode(t),t.slice(),e),declareIdentInScope(e.id.name,n,r)),!1;case Syntax.VariableDeclarator:"var"===t[0].kind&&(n=initScopeMetadata(getBoundaryNode(t),t.slice(),e),declareIdentInScope(e.id.name,n,r))}}function visitLocalBlockIdentifiers(e){return e.type===Syntax.CatchClause?!1:void 0}function walker(e,t,r){for(var n=r.g.visitors,a=0;a<n.length;a++)if(n[a].test(e,t,r))return n[a](traverse,e,t,r)}function transform(e,t,r){r=r||{};var n;try{var a=_astCache[t];n=a||(_astCache[t]=esprima.parse(t,{comment:!0,loc:!0,range:!0}))}catch(o){throw o.message="Parse Error: "+o.message,o}var i=utils.createState(t,n,r);if(i.g.visitors=e,r.sourceMap){var u=require("source-map").SourceMapGenerator;i.g.sourceMap=new u({file:r.filename||"transformed.js"})}traverse(n,[],i),utils.catchup(t.length,i);var s={code:i.g.buffer,extra:i.g.extra};return r.sourceMap&&(s.sourceMap=i.g.sourceMap,s.sourceMapFilename=r.filename||"source.js"),s}var esprima=require("esprima-fb"),utils=require("./utils"),getBoundaryNode=utils.getBoundaryNode,declareIdentInScope=utils.declareIdentInLocalScope,initScopeMetadata=utils.initScopeMetadata,Syntax=esprima.Syntax,_astCache={};exports.transform=transform,exports.Syntax=Syntax;
//# sourceMappingURL=jstransform.js.map